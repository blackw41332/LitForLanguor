<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">

  <title>{{ page.title }} | {{ site.title | default: 'Lit for Languor' }}</title>
  <link rel="stylesheet" href="{{ '/assets/css/style.css' | relative_url }}">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1><a href="{{ '/' | relative_url }}">{{ site.title | default: 'Lit for Languor' }}</a></h1>
      <nav class="site-nav">
        <a href="{{ '/' | relative_url }}">Home</a>
        <a href="{{ '/stories/' | relative_url }}">Stories</a>
        <a href="{{ '/poems/' | relative_url }}">Poems</a>
        <a href="{{ '/short-stories/' | relative_url }}">Short Stories</a>
        <a href="{{ '/reading-of-the-day/' | relative_url }}">Daily Read</a>
      </nav>
      <button id="theme-toggle" aria-label="Toggle theme"></button>
    </div>
  </header>

  <main class="content">
    <div class="container">
      {{ content }}
    </div>
  </main>

  <footer class="site-footer">
    <div class="container">
      <small>&copy; {{ site.time | date: "%Y" }} {{ site.title | default: "Lit for Languor" }}</small>
    </div>
  </footer>
  <script>
  const btn = document.getElementById('theme-toggle');
  const root = document.documentElement;
  const icons = { light: '🌙', dark: '☀️' };

  // Initialize theme & icon
  let theme = localStorage.getItem('theme');
  if (!theme) {
    // default to system preference
    theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
  }
  root.setAttribute('data-theme', theme);
  btn.textContent = icons[theme];

  // Toggle on click
  btn.addEventListener('click', () => {
    theme = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
    root.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
    btn.textContent = icons[theme];
  });
</script>
<!-- reading-of-the-day randomizer -->
<script>
    document.addEventListener("DOMContentLoaded", async () => {
      // 1) Build reads[] from all .docx in your three folders
      const reads = [
        {% assign docs_stories = site.static_files | where: "extname", ".docx" | where_exp: "f", "f.path contains '/stories/'" %}
{% assign docs_poems   = site.static_files | where: "extname", ".docx" | where_exp: "f", "f.path contains '/poems/'" %}
{% assign docs_shorts  = site.static_files | where: "extname", ".docx" | where_exp: "f", "f.path contains '/short-stories/'" %}
{% assign docs = docs_stories | concat: docs_poems | concat: docs_shorts %}

        {% for f in docs %}
          {
            "pageUrl": "{{ f.path | replace: '.docx', '.html' | relative_url }}",
            "docUrl":  "{{ f.path | relative_url }}",
            "type":    "{% if f.path contains '/poems/' %}poem{% else %}story{% endif %}"
          }{% unless forloop.last %},{% endunless %}
        {% endfor %}
      ];

      // 2) Pick one at random
      const pick = reads[Math.floor(Math.random() * reads.length)];

      try {
        // 3) Fetch & parse the HTML version
        const res  = await fetch(pick.pageUrl);
        const html = await res.text();
        const doc  = new DOMParser().parseFromString(html, "text/html");

        // 4) Pull paragraphs from your default <main class="content">
        const rootEl = doc.querySelector(".content") || doc.querySelector("main");
        const paras  = Array.from(rootEl.querySelectorAll("p"));

        // 5) Snippet logic: 1 <p> for poems, 3 for stories
        const count   = pick.type === "poem" ? 1 : 3;
        const snippet = paras
          .slice(0, count)
          .map(p => `<p>${p.innerHTML}</p>`)
          .join("");

        // 6) Inject into the page & link to the .docx
        document.getElementById("daily-content").innerHTML = snippet;
        document.getElementById("daily-link").href         = pick.docUrl;
      } catch (err) {
        console.error("Daily Read failed:", err);
        document.getElementById("daily-content")
          .textContent = "Sorry, today's reading failed to load.";
      }
    });
  </script>
</body>
</html>
